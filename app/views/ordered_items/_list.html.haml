= javascript_include_tag "#{ServicesSettings.pubsub.mount_point}.js"
- order_item_template = capture do
  %li
    %span{ "data-order-id" => "%{order_id}", "data-item-id" => "%{item_id}", :href => "#" } %{item_name}
:javascript
  var orderItemsChannel = #{OrderItem.channel.to_json};
  var pubsubClient = new Faye.Client("#{ServicesSettings.pubsub.mount_point}");
  var orderItemTemplate = #{order_item_template.to_json};
  $(function(){
    pubsubClient.subscribe(orderItemsChannel, function(message){
      $('#ordered_items').append(orderItemTemplate.gsub(message))
      $('#ordered_items').listview('refresh')
    })
  })

%div{ "data-role" => "page" }
  %div{ "data-role" => "header" }
    %h1= t("ordered_items.header")
  %ul#ordered_items{ "data-role" => "listview", "data-theme" => "c", "data-dividertheme" => "b" }
    - OrderItem.all.each do |order_item|
      %li
        %span{ "data-order-id" => order_item.order_id, "data-item-id" => order_item.item_id, :href => "#" }= order_item.item_name

