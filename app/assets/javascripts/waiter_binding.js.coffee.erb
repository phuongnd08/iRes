$(document).delegate '#navigator_page', "pagecreate", ->
    ordersChannel = <%= Order.channel.to_json %>
    pubsubClient = new Faye.Client(<%= ServicesSettings.pubsub.mount_point.to_json %>)
    pubsubClient.subscribe ordersChannel, (order) ->
      orderHash =
        id: order.id
        table: I18n.t("order.table_no", "no": order.table_number)

      $('#orders').append(JST["templates/order_entry"]().gsub orderHash)
      $('#orders').listview('refresh')

$(document).delegate "#order_page", "pagecreate", ->
  showPage = (selector) ->
    $(".subpage").hide()
    $(selector).show()
    $("#order_page [data-role=navbar] li a").setHeaderInactive()
    $("#order_page [data-nav-to=\"" + selector + "}\"] li a").setHeaderActive()

  $("#order_page [data-role=navbar] li a").click (event) ->
    event.preventDefault()
    showPage $(this).attr("data-nav-to")

  $("#ordering .item").click (event) ->
    event.preventDefault()
    Waiter.addItem $(this).attr("data-item-id"), $(this).text()

  $('#ordered').on 'click', '.remove', ->
    Waiter.removeItem $(this).closest('li').attr('data-item-identifier')

  $("#commit_btn").click (event) ->
    event.preventDefault()
    Waiter.commitOrder this
